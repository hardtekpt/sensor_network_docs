<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sensor_network: /sensor_network/node/comms_protocol.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sensor_network
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">/sensor_network/node/comms_protocol.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Communication Protocol library - set of functions and data structures used to build a network using the LoRa modulation radios.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="comms__protocol_8h_source.html">comms_protocol.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5cff2e13cf4105bf39e0843561f55637"><td class="memItemLeft" align="right" valign="top">cppQueue&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a5cff2e13cf4105bf39e0843561f55637">msg_q</a> (sizeof(<a class="el" href="comms__protocol_8h.html#ad014e4a11d57536042f2c321a8bbbb05">Msg</a>), <a class="el" href="comms__protocol_8h.html#a623ec78b7909090dbedac4af1d52abb4">MAX_QUEUE_SIZE</a>, <a class="el" href="comms__protocol_8h.html#aafd24a334088de3d7fef309914d49101">IMPLEMENTATION</a>)</td></tr>
<tr class="separator:a5cff2e13cf4105bf39e0843561f55637"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af107f16dd1552bb658c1936141d9ae7a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#af107f16dd1552bb658c1936141d9ae7a">LoRa_rxMode</a> ()</td></tr>
<tr class="memdesc:af107f16dd1552bb658c1936141d9ae7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the LoRa radio to receive mode.  <a href="comms__protocol_8cpp.html#af107f16dd1552bb658c1936141d9ae7a">More...</a><br /></td></tr>
<tr class="separator:af107f16dd1552bb658c1936141d9ae7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2b412b05e4e8c055d44f3eaab81a3ec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#af2b412b05e4e8c055d44f3eaab81a3ec">LoRa_txMode</a> ()</td></tr>
<tr class="memdesc:af2b412b05e4e8c055d44f3eaab81a3ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the LoRa radio to transmit mode.  <a href="comms__protocol_8cpp.html#af2b412b05e4e8c055d44f3eaab81a3ec">More...</a><br /></td></tr>
<tr class="separator:af2b412b05e4e8c055d44f3eaab81a3ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af16159d027d3309f71766d777aa5c83c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#af16159d027d3309f71766d777aa5c83c">LoRa_sendMessage</a> (byte *message)</td></tr>
<tr class="memdesc:af16159d027d3309f71766d777aa5c83c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the radio to transmit mode, sends a message string using the LoRa radio and sets the radio back to receive mode.  <a href="comms__protocol_8cpp.html#af16159d027d3309f71766d777aa5c83c">More...</a><br /></td></tr>
<tr class="separator:af16159d027d3309f71766d777aa5c83c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79398995c7c5c2a679ce806660617aa5"><td class="memItemLeft" align="right" valign="top">byte *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a79398995c7c5c2a679ce806660617aa5">splitAndEncrypt2</a> (char msg[<a class="el" href="comms__protocol_8h.html#a6303f7392a2d06be5a121c54278d561b">MAX_PAYLOAD_SIZE</a>])</td></tr>
<tr class="memdesc:a79398995c7c5c2a679ce806660617aa5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encrypts a message (character array) using the AES256 algorythm with the corresponding node key The encryption is made by encrypting blocks of 16 bytes and joining them together.  <a href="comms__protocol_8cpp.html#a79398995c7c5c2a679ce806660617aa5">More...</a><br /></td></tr>
<tr class="separator:a79398995c7c5c2a679ce806660617aa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd48c535050ffcd708e68f1a495c809e"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#acd48c535050ffcd708e68f1a495c809e">decryptMsg2</a> (char msg[<a class="el" href="comms__protocol_8h.html#a6303f7392a2d06be5a121c54278d561b">MAX_PAYLOAD_SIZE</a>+1])</td></tr>
<tr class="memdesc:acd48c535050ffcd708e68f1a495c809e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decrypts a message string using the AES256 algorythm with the corresponding node key.  <a href="comms__protocol_8cpp.html#acd48c535050ffcd708e68f1a495c809e">More...</a><br /></td></tr>
<tr class="separator:acd48c535050ffcd708e68f1a495c809e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8271805926e924f56b4d0f889c8bec1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#ac8271805926e924f56b4d0f889c8bec1">mymin</a> (int a, int b)</td></tr>
<tr class="memdesc:ac8271805926e924f56b4d0f889c8bec1"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns the minimum value between two integers  <a href="comms__protocol_8cpp.html#ac8271805926e924f56b4d0f889c8bec1">More...</a><br /></td></tr>
<tr class="separator:ac8271805926e924f56b4d0f889c8bec1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cb3b91f794c0555e3adbe5fce614074"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a4cb3b91f794c0555e3adbe5fce614074">sendAck</a> (byte msgID)</td></tr>
<tr class="memdesc:a4cb3b91f794c0555e3adbe5fce614074"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an acknowledge message confirming the reception of an uplink transmission.  <a href="comms__protocol_8cpp.html#a4cb3b91f794c0555e3adbe5fce614074">More...</a><br /></td></tr>
<tr class="separator:a4cb3b91f794c0555e3adbe5fce614074"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ac3eeb5847878d4d438bfa7622eb428"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a3ac3eeb5847878d4d438bfa7622eb428">sendStatus</a> (byte msgID)</td></tr>
<tr class="memdesc:a3ac3eeb5847878d4d438bfa7622eb428"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an uplink message containing the node status.  <a href="comms__protocol_8cpp.html#a3ac3eeb5847878d4d438bfa7622eb428">More...</a><br /></td></tr>
<tr class="separator:a3ac3eeb5847878d4d438bfa7622eb428"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a422ca7dc35be9c6885ef6a17191d2d5b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a422ca7dc35be9c6885ef6a17191d2d5b">setActState</a> (int ID, int val)</td></tr>
<tr class="memdesc:a422ca7dc35be9c6885ef6a17191d2d5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the state of the relevant actuator with the relevant value.  <a href="comms__protocol_8cpp.html#a422ca7dc35be9c6885ef6a17191d2d5b">More...</a><br /></td></tr>
<tr class="separator:a422ca7dc35be9c6885ef6a17191d2d5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae084789be1260b3603c726abedbf8631"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#ae084789be1260b3603c726abedbf8631">sendSensorData</a> (byte sensorID, byte sensorVal)</td></tr>
<tr class="memdesc:ae084789be1260b3603c726abedbf8631"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds to the message queue an uplink message containing sensor data.  <a href="comms__protocol_8cpp.html#ae084789be1260b3603c726abedbf8631">More...</a><br /></td></tr>
<tr class="separator:ae084789be1260b3603c726abedbf8631"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a091b9218e6ed5b060bc3d1104dde7109"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a091b9218e6ed5b060bc3d1104dde7109">getMsgFromQueueAndSend</a> (unsigned long currentMillis)</td></tr>
<tr class="memdesc:a091b9218e6ed5b060bc3d1104dde7109"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a message from the send queue and send it. Implements retransmission in case an acknowledge message is not received. Aware of a failed transmission.  <a href="comms__protocol_8cpp.html#a091b9218e6ed5b060bc3d1104dde7109">More...</a><br /></td></tr>
<tr class="separator:a091b9218e6ed5b060bc3d1104dde7109"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54817002e33761dc61558b1138749dfb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a54817002e33761dc61558b1138749dfb">onReceive</a> (int packetSize)</td></tr>
<tr class="memdesc:a54817002e33761dc61558b1138749dfb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called every time a new message is received. Filters unwanted messages, decrypts the payload, gets the relevant fields from the payload and sends back an acknowledge message if necessary.  <a href="comms__protocol_8cpp.html#a54817002e33761dc61558b1138749dfb">More...</a><br /></td></tr>
<tr class="separator:a54817002e33761dc61558b1138749dfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0a46edecb372aedab666bb0b845ba6b8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a0a46edecb372aedab666bb0b845ba6b8">currMsg</a> = -1</td></tr>
<tr class="separator:a0a46edecb372aedab666bb0b845ba6b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad43c3812e6d13e0518d9f8b8f463ffcf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0</td></tr>
<tr class="separator:ad43c3812e6d13e0518d9f8b8f463ffcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afad07369259cd493d556473fa3ba8433"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#afad07369259cd493d556473fa3ba8433">prevMil</a></td></tr>
<tr class="separator:afad07369259cd493d556473fa3ba8433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a903ae438e3a8c1bd9edb5aecb54d25d3"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a903ae438e3a8c1bd9edb5aecb54d25d3">prevMilSU</a></td></tr>
<tr class="separator:a903ae438e3a8c1bd9edb5aecb54d25d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf58c4ea1cc64b2a020319e64031c008"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#abf58c4ea1cc64b2a020319e64031c008">VBAT</a> = 1.0</td></tr>
<tr class="separator:abf58c4ea1cc64b2a020319e64031c008"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acba68ade9b1d4ddf6d4289092bd9f21d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#acba68ade9b1d4ddf6d4289092bd9f21d">msgCount</a> = 0</td></tr>
<tr class="separator:acba68ade9b1d4ddf6d4289092bd9f21d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ebab104a77fc87f092da8bc068a58f"><td class="memItemLeft" align="right" valign="top">aes256_context&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="comms__protocol_8cpp.html#a38ebab104a77fc87f092da8bc068a58f">ctxt</a></td></tr>
<tr class="separator:a38ebab104a77fc87f092da8bc068a58f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Communication Protocol library - set of functions and data structures used to build a network using the LoRa modulation radios. </p>
<dl class="section author"><dt>Author</dt><dd>Francisco Santos (<a href="#" onclick="location.href='mai'+'lto:'+'fra'+'nc'+'isc'+'o.'+'vel'+'ez'+'@te'+'cn'+'ico'+'.u'+'lis'+'bo'+'a.p'+'t'; return false;">franc<span style="display: none;">.nosp@m.</span>isco<span style="display: none;">.nosp@m.</span>.vele<span style="display: none;">.nosp@m.</span>z@te<span style="display: none;">.nosp@m.</span>cnico<span style="display: none;">.nosp@m.</span>.uli<span style="display: none;">.nosp@m.</span>sboa.<span style="display: none;">.nosp@m.</span>pt</a>) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2022-08-10</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) 2022 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="acd48c535050ffcd708e68f1a495c809e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd48c535050ffcd708e68f1a495c809e">&#9670;&nbsp;</a></span>decryptMsg2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* decryptMsg2 </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>msg</em>[MAX_PAYLOAD_SIZE+1]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decrypts a message string using the AES256 algorythm with the corresponding node key. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>message string to be decrypted </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>char* an array of characters containing the decrypted message </dd></dl>

</div>
</div>
<a id="a091b9218e6ed5b060bc3d1104dde7109"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a091b9218e6ed5b060bc3d1104dde7109">&#9670;&nbsp;</a></span>getMsgFromQueueAndSend()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getMsgFromQueueAndSend </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>currentMillis</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a message from the send queue and send it. Implements retransmission in case an acknowledge message is not received. Aware of a failed transmission. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">currentMillis</td><td>current time in millisenconds since boot </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="af107f16dd1552bb658c1936141d9ae7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af107f16dd1552bb658c1936141d9ae7a">&#9670;&nbsp;</a></span>LoRa_rxMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LoRa_rxMode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the LoRa radio to receive mode. </p>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="af16159d027d3309f71766d777aa5c83c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af16159d027d3309f71766d777aa5c83c">&#9670;&nbsp;</a></span>LoRa_sendMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LoRa_sendMessage </td>
          <td>(</td>
          <td class="paramtype">byte *&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the radio to transmit mode, sends a message string using the LoRa radio and sets the radio back to receive mode. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>message to send </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="af2b412b05e4e8c055d44f3eaab81a3ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2b412b05e4e8c055d44f3eaab81a3ec">&#9670;&nbsp;</a></span>LoRa_txMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LoRa_txMode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the LoRa radio to transmit mode. </p>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a5cff2e13cf4105bf39e0843561f55637"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cff2e13cf4105bf39e0843561f55637">&#9670;&nbsp;</a></span>msg_q()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cppQueue msg_q </td>
          <td>(</td>
          <td class="paramtype">sizeof(<a class="el" href="comms__protocol_8h.html#ad014e4a11d57536042f2c321a8bbbb05">Msg</a>)&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="comms__protocol_8h.html#a623ec78b7909090dbedac4af1d52abb4">MAX_QUEUE_SIZE</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="comms__protocol_8h.html#aafd24a334088de3d7fef309914d49101">IMPLEMENTATION</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac8271805926e924f56b4d0f889c8bec1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8271805926e924f56b4d0f889c8bec1">&#9670;&nbsp;</a></span>mymin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mymin </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>returns the minimum value between two integers </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>first integer to compare </td></tr>
    <tr><td class="paramname">b</td><td>second integer to compare </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int the smaller between a and b </dd></dl>

</div>
</div>
<a id="a54817002e33761dc61558b1138749dfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54817002e33761dc61558b1138749dfb">&#9670;&nbsp;</a></span>onReceive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void onReceive </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>packetSize</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called every time a new message is received. Filters unwanted messages, decrypts the payload, gets the relevant fields from the payload and sends back an acknowledge message if necessary. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">packetSize</td><td>size of the incoming message in bytes </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a4cb3b91f794c0555e3adbe5fce614074"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cb3b91f794c0555e3adbe5fce614074">&#9670;&nbsp;</a></span>sendAck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendAck </td>
          <td>(</td>
          <td class="paramtype">byte&#160;</td>
          <td class="paramname"><em>msgID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send an acknowledge message confirming the reception of an uplink transmission. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msgID</td><td>ID of the message being acknowledged </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="ae084789be1260b3603c726abedbf8631"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae084789be1260b3603c726abedbf8631">&#9670;&nbsp;</a></span>sendSensorData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendSensorData </td>
          <td>(</td>
          <td class="paramtype">byte&#160;</td>
          <td class="paramname"><em>sensorID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">byte&#160;</td>
          <td class="paramname"><em>sensorVal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds to the message queue an uplink message containing sensor data. </p>
<p>Note: The ADC value is a 12-bit number, so the maximum value is 4095 (counting from 0). To convert the ADC integer value to a real voltage youâ€™ll need to divide it by the maximum value of 4095, then double it (note above that Adafruit halves the voltage), then multiply that by the reference voltage of the ESP32 which is 3.3V and then vinally, multiply that again by the ADC Reference Voltage of 1100mV.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sensorID</td><td>ID of the relevant sensor </td></tr>
    <tr><td class="paramname">sensorVal</td><td>value read from the relevant sensor </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a3ac3eeb5847878d4d438bfa7622eb428"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ac3eeb5847878d4d438bfa7622eb428">&#9670;&nbsp;</a></span>sendStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendStatus </td>
          <td>(</td>
          <td class="paramtype">byte&#160;</td>
          <td class="paramname"><em>msgID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send an uplink message containing the node status. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msgID</td><td>ID of the status request message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a422ca7dc35be9c6885ef6a17191d2d5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a422ca7dc35be9c6885ef6a17191d2d5b">&#9670;&nbsp;</a></span>setActState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setActState </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the state of the relevant actuator with the relevant value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ID</td><td>ID of the relevant actuator </td></tr>
    <tr><td class="paramname">val</td><td>value to which the actuator is set to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a79398995c7c5c2a679ce806660617aa5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79398995c7c5c2a679ce806660617aa5">&#9670;&nbsp;</a></span>splitAndEncrypt2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">byte* splitAndEncrypt2 </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>msg</em>[MAX_PAYLOAD_SIZE]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encrypts a message (character array) using the AES256 algorythm with the corresponding node key The encryption is made by encrypting blocks of 16 bytes and joining them together. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>message array to be decrypted </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>byte* a byte array containing the encrypted message </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ad43c3812e6d13e0518d9f8b8f463ffcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad43c3812e6d13e0518d9f8b8f463ffcf">&#9670;&nbsp;</a></span>count</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int count = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a38ebab104a77fc87f092da8bc068a58f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38ebab104a77fc87f092da8bc068a58f">&#9670;&nbsp;</a></span>ctxt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">aes256_context ctxt</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0a46edecb372aedab666bb0b845ba6b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a46edecb372aedab666bb0b845ba6b8">&#9670;&nbsp;</a></span>currMsg</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int currMsg = -1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acba68ade9b1d4ddf6d4289092bd9f21d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acba68ade9b1d4ddf6d4289092bd9f21d">&#9670;&nbsp;</a></span>msgCount</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int msgCount = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="afad07369259cd493d556473fa3ba8433"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afad07369259cd493d556473fa3ba8433">&#9670;&nbsp;</a></span>prevMil</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long prevMil</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a903ae438e3a8c1bd9edb5aecb54d25d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a903ae438e3a8c1bd9edb5aecb54d25d3">&#9670;&nbsp;</a></span>prevMilSU</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long prevMilSU</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="abf58c4ea1cc64b2a020319e64031c008"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf58c4ea1cc64b2a020319e64031c008">&#9670;&nbsp;</a></span>VBAT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float VBAT = 1.0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
