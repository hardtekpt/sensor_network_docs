
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Francisco Santos">
      
      
        <link rel="canonical" href="https://hardtekpt.github.io/sensor_network_docs/Node/Files/comms__protocol_8h/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.1">
    
    
      
        <title>comms_protocol.h - Sensor Network Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#comms_protocolh" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Sensor Network Documentation" class="md-header__button md-logo" aria-label="Sensor Network Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sensor Network Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              comms_protocol.h
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dsor-isr/sensor_network_docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    sensor_network_docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Sensor Network Documentation" class="md-nav__button md-logo" aria-label="Sensor Network Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Sensor Network Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dsor-isr/sensor_network_docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    sensor_network_docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/repo_structure/" class="md-nav__link">
        Repository Structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/install_guide/" class="md-nav__link">
        Install Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/example_usage/" class="md-nav__link">
        Example Usage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Packages Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Packages Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Packages Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Node
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Node" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Node
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Classes/" class="md-nav__link">
        Classes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Gateway
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Gateway" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Gateway
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Gateway/Files/" class="md-nav__link">
        Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Gateway/Classes/" class="md-nav__link">
        Classes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types" class="md-nav__link">
    Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defines" class="md-nav__link">
    Defines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-description" class="md-nav__link">
    Detailed Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-documentation" class="md-nav__link">
    Types Documentation
  </a>
  
    <nav class="md-nav" aria-label="Types Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typedef-payload" class="md-nav__link">
    typedef Payload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typedef-msg" class="md-nav__link">
    typedef Msg
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions-documentation" class="md-nav__link">
    Functions Documentation
  </a>
  
    <nav class="md-nav" aria-label="Functions Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-lora_rxmode" class="md-nav__link">
    function LoRa_rxMode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-lora_txmode" class="md-nav__link">
    function LoRa_txMode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-lora_sendmessage" class="md-nav__link">
    function LoRa_sendMessage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-decryptmsg" class="md-nav__link">
    function decryptMsg
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-decryptmsg2" class="md-nav__link">
    function decryptMsg2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-onreceive" class="md-nav__link">
    function onReceive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-ontxdone" class="md-nav__link">
    function onTxDone
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-splitandencrypt" class="md-nav__link">
    function splitAndEncrypt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-sendsensordata" class="md-nav__link">
    function sendSensorData
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-getmsgfromqueueandsend" class="md-nav__link">
    function getMsgFromQueueAndSend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-sendstatus" class="md-nav__link">
    function sendStatus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-sendack" class="md-nav__link">
    function sendAck
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-setactstate" class="md-nav__link">
    function setActState
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-mymin" class="md-nav__link">
    function mymin
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attributes-documentation" class="md-nav__link">
    Attributes Documentation
  </a>
  
    <nav class="md-nav" aria-label="Attributes Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variable-keybroadcast" class="md-nav__link">
    variable keyBroadcast
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-frequency" class="md-nav__link">
    variable frequency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-txpower" class="md-nav__link">
    variable txPower
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-spreadingfactor" class="md-nav__link">
    variable spreadingFactor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-signalbandwidth" class="md-nav__link">
    variable signalBandwidth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-codingratedenominator" class="md-nav__link">
    variable codingRateDenominator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-currmsg" class="md-nav__link">
    variable currMsg
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-count" class="md-nav__link">
    variable count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-prevmil" class="md-nav__link">
    variable prevMil
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-prevmilsu" class="md-nav__link">
    variable prevMilSU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-msgcount" class="md-nav__link">
    variable msgCount
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-msg_q" class="md-nav__link">
    variable msg_q
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-ctxt" class="md-nav__link">
    variable ctxt
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macros-documentation" class="md-nav__link">
    Macros Documentation
  </a>
  
    <nav class="md-nav" aria-label="Macros Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-implementation" class="md-nav__link">
    define IMPLEMENTATION
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-max_n_retry" class="md-nav__link">
    define MAX_N_RETRY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-timeout_interval" class="md-nav__link">
    define TIMEOUT_INTERVAL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-max_queue_size" class="md-nav__link">
    define MAX_QUEUE_SIZE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-block_size" class="md-nav__link">
    define BLOCK_SIZE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-max_payload_size" class="md-nav__link">
    define MAX_PAYLOAD_SIZE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-enc_block_size" class="md-nav__link">
    define ENC_BLOCK_SIZE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-max_enc_payload_size" class="md-nav__link">
    define MAX_ENC_PAYLOAD_SIZE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-max_msg_id" class="md-nav__link">
    define MAX_MSG_ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-status_update_interval" class="md-nav__link">
    define STATUS_UPDATE_INTERVAL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-broadcast_id" class="md-nav__link">
    define BROADCAST_ID
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source code
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/dsor-isr/sensor_network_docs/edit/master/node/docs/Files/comms__protocol_8h.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="comms_protocolh">comms_protocol.h</h1>
<p>Header file for the communication protocol library. Contains the used data structures, function declaration and general configuartion options for the library.  <a href="#detailed-description">More...</a></p>
<h2 id="classes">Classes</h2>
<table>
<thead>
<tr>
<th></th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct</td>
<td><strong><a href="/Node/Classes/structstr_payload/">strPayload</a></strong></td>
</tr>
<tr>
<td>struct</td>
<td><strong><a href="/Node/Classes/structstr_msg/">strMsg</a></strong></td>
</tr>
</tbody>
</table>
<h2 id="types">Types</h2>
<table>
<thead>
<tr>
<th></th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>typedef struct <a href="/Node/Classes/structstr_payload/">strPayload</a></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#typedef-payload">Payload</a></strong></td>
</tr>
<tr>
<td>typedef struct <a href="/Node/Classes/structstr_msg/">strMsg</a></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#typedef-msg">Msg</a></strong></td>
</tr>
</tbody>
</table>
<h2 id="functions">Functions</h2>
<table>
<thead>
<tr>
<th></th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-lora-rxmode">LoRa_rxMode</a></strong>()<br>Sets the LoRa radio to receive mode.</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-lora-txmode">LoRa_txMode</a></strong>()<br>Sets the LoRa radio to transmit mode.</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-lora-sendmessage">LoRa_sendMessage</a></strong>(byte * message)<br>Sets the radio to transmit mode, sends a message string using the LoRa radio and sets the radio back to receive mode.</td>
</tr>
<tr>
<td>char *</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-decryptmsg">decryptMsg</a></strong>(String msg)</td>
</tr>
<tr>
<td>char *</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-decryptmsg2">decryptMsg2</a></strong>(char msg[MAX_PAYLOAD_SIZE+1])<br>Decrypts a message string using the AES256 algorythm with the corresponding node key.</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-onreceive">onReceive</a></strong>(int packetSize)<br>Called every time a new message is received. Filters unwanted messages, decrypts the payload, gets the relevant fields from the payload and sends back an acknowledge message if necessary.</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-ontxdone">onTxDone</a></strong>()</td>
</tr>
<tr>
<td>String</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-splitandencrypt">splitAndEncrypt</a></strong>(char msg[MAX_PAYLOAD_SIZE])</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-sendsensordata">sendSensorData</a></strong>(byte sensorID, byte sensorVal)<br>Adds to the message queue an uplink message containing sensor data.</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-getmsgfromqueueandsend">getMsgFromQueueAndSend</a></strong>(unsigned long currentMillis)<br>Get a message from the send queue and send it. Implements retransmission in case an acknowledge message is not received. Aware of a failed transmission.</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-sendstatus">sendStatus</a></strong>(byte msgID)<br>Send an uplink message containing the node status.</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-sendack">sendAck</a></strong>(byte msgID)<br>Send an acknowledge message confirming the reception of an uplink transmission.</td>
</tr>
<tr>
<td>void</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-setactstate">setActState</a></strong>(int ID, int val)<br>Sets the state of the relevant actuator with the relevant value.</td>
</tr>
<tr>
<td>int</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#function-mymin">mymin</a></strong>(int a, int b)<br>returns the minimum value between two integers</td>
</tr>
</tbody>
</table>
<h2 id="attributes">Attributes</h2>
<table>
<thead>
<tr>
<th></th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>const uint8_t</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-keybroadcast">keyBroadcast</a></strong></td>
</tr>
<tr>
<td>const long</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-frequency">frequency</a></strong></td>
</tr>
<tr>
<td>const int</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-txpower">txPower</a></strong></td>
</tr>
<tr>
<td>const int</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-spreadingfactor">spreadingFactor</a></strong></td>
</tr>
<tr>
<td>const long</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-signalbandwidth">signalBandwidth</a></strong></td>
</tr>
<tr>
<td>const int</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-codingratedenominator">codingRateDenominator</a></strong></td>
</tr>
<tr>
<td>int</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-currmsg">currMsg</a></strong></td>
</tr>
<tr>
<td>int</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-count">count</a></strong></td>
</tr>
<tr>
<td>unsigned long</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-prevmil">prevMil</a></strong></td>
</tr>
<tr>
<td>unsigned long</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-prevmilsu">prevMilSU</a></strong></td>
</tr>
<tr>
<td>int</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-msgcount">msgCount</a></strong></td>
</tr>
<tr>
<td>cppQueue</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-msg-q">msg_q</a></strong></td>
</tr>
<tr>
<td>aes256_context</td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#variable-ctxt">ctxt</a></strong></td>
</tr>
</tbody>
</table>
<h2 id="defines">Defines</h2>
<table>
<thead>
<tr>
<th></th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-implementation">IMPLEMENTATION</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-max-n-retry">MAX_N_RETRY</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-timeout-interval">TIMEOUT_INTERVAL</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-max-queue-size">MAX_QUEUE_SIZE</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-block-size">BLOCK_SIZE</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-max-payload-size">MAX_PAYLOAD_SIZE</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-enc-block-size">ENC_BLOCK_SIZE</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-max-enc-payload-size">MAX_ENC_PAYLOAD_SIZE</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-max-msg-id">MAX_MSG_ID</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-status-update-interval">STATUS_UPDATE_INTERVAL</a></strong></td>
</tr>
<tr>
<td></td>
<td><strong><a href="/Node/Files/comms__protocol_8h/#define-broadcast-id">BROADCAST_ID</a></strong></td>
</tr>
</tbody>
</table>
<h2 id="detailed-description">Detailed Description</h2>
<p>Header file for the communication protocol library. Contains the used data structures, function declaration and general configuartion options for the library. </p>
<p><strong>Author</strong>: Francisco Santos (<a href="mailto:francisco.velez@tecnico.ulisboa.pt">francisco.velez@tecnico.ulisboa.pt</a>) </p>
<p><strong>Version</strong>: 1.0 </p>
<p><strong>Date</strong>: 2022-08-10</p>
<p><strong>Copyright</strong>: Copyright (c) 2022 </p>
<h2 id="types-documentation">Types Documentation</h2>
<h3 id="typedef-payload">typedef Payload</h3>
<pre><code class="language-cpp">typedef struct strPayload Payload;
</code></pre>
<h3 id="typedef-msg">typedef Msg</h3>
<pre><code class="language-cpp">typedef struct strMsg Msg;
</code></pre>
<h2 id="functions-documentation">Functions Documentation</h2>
<h3 id="function-lora_rxmode">function LoRa_rxMode</h3>
<pre><code class="language-cpp">void LoRa_rxMode()
</code></pre>
<p>Sets the LoRa radio to receive mode. </p>
<p><strong>Return</strong>: void </p>
<h3 id="function-lora_txmode">function LoRa_txMode</h3>
<pre><code class="language-cpp">void LoRa_txMode()
</code></pre>
<p>Sets the LoRa radio to transmit mode. </p>
<p><strong>Return</strong>: void </p>
<h3 id="function-lora_sendmessage">function LoRa_sendMessage</h3>
<pre><code class="language-cpp">void LoRa_sendMessage(
    byte * message
)
</code></pre>
<p>Sets the radio to transmit mode, sends a message string using the LoRa radio and sets the radio back to receive mode. </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>message</strong> message to send </li>
</ul>
<p><strong>Return</strong>: void </p>
<h3 id="function-decryptmsg">function decryptMsg</h3>
<pre><code class="language-cpp">char * decryptMsg(
    String msg
)
</code></pre>
<h3 id="function-decryptmsg2">function decryptMsg2</h3>
<pre><code class="language-cpp">char * decryptMsg2(
    char msg[MAX_PAYLOAD_SIZE+1]
)
</code></pre>
<p>Decrypts a message string using the AES256 algorythm with the corresponding node key. </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>msg</strong> message string to be decrypted </li>
</ul>
<p><strong>Return</strong>: char* an array of characters containing the decrypted message </p>
<h3 id="function-onreceive">function onReceive</h3>
<pre><code class="language-cpp">void onReceive(
    int packetSize
)
</code></pre>
<p>Called every time a new message is received. Filters unwanted messages, decrypts the payload, gets the relevant fields from the payload and sends back an acknowledge message if necessary. </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>packetSize</strong> size of the incoming message in bytes </li>
</ul>
<p><strong>Return</strong>: void </p>
<h3 id="function-ontxdone">function onTxDone</h3>
<pre><code class="language-cpp">void onTxDone()
</code></pre>
<h3 id="function-splitandencrypt">function splitAndEncrypt</h3>
<pre><code class="language-cpp">String splitAndEncrypt(
    char msg[MAX_PAYLOAD_SIZE]
)
</code></pre>
<h3 id="function-sendsensordata">function sendSensorData</h3>
<pre><code class="language-cpp">void sendSensorData(
    byte sensorID,
    byte sensorVal
)
</code></pre>
<p>Adds to the message queue an uplink message containing sensor data. </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>sensorID</strong> ID of the relevant sensor </li>
<li><strong>sensorVal</strong> value read from the relevant sensor </li>
</ul>
<p><strong>Return</strong>: void </p>
<p>Note: The ADC value is a 12-bit number, so the maximum value is 4095 (counting from 0). To convert the ADC integer value to a real voltage youâ€™ll need to divide it by the maximum value of 4095, then double it (note above that Adafruit halves the voltage), then multiply that by the reference voltage of the ESP32 which is 3.3V and then vinally, multiply that again by the ADC Reference Voltage of 1100mV.</p>
<h3 id="function-getmsgfromqueueandsend">function getMsgFromQueueAndSend</h3>
<pre><code class="language-cpp">void getMsgFromQueueAndSend(
    unsigned long currentMillis
)
</code></pre>
<p>Get a message from the send queue and send it. Implements retransmission in case an acknowledge message is not received. Aware of a failed transmission. </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>currentMillis</strong> current time in millisenconds since boot </li>
</ul>
<p><strong>Return</strong>: void </p>
<h3 id="function-sendstatus">function sendStatus</h3>
<pre><code class="language-cpp">void sendStatus(
    byte msgID
)
</code></pre>
<p>Send an uplink message containing the node status. </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>msgID</strong> ID of the status request message </li>
</ul>
<p><strong>Return</strong>: void </p>
<h3 id="function-sendack">function sendAck</h3>
<pre><code class="language-cpp">void sendAck(
    byte msgID
)
</code></pre>
<p>Send an acknowledge message confirming the reception of an uplink transmission. </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>msgID</strong> ID of the message being acknowledged </li>
</ul>
<p><strong>Return</strong>: void </p>
<h3 id="function-setactstate">function setActState</h3>
<pre><code class="language-cpp">void setActState(
    int ID,
    int val
)
</code></pre>
<p>Sets the state of the relevant actuator with the relevant value. </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>ID</strong> ID of the relevant actuator </li>
<li><strong>val</strong> value to which the actuator is set to </li>
</ul>
<p><strong>Return</strong>: void </p>
<h3 id="function-mymin">function mymin</h3>
<pre><code class="language-cpp">int mymin(
    int a,
    int b
)
</code></pre>
<p>returns the minimum value between two integers </p>
<p><strong>Parameters</strong>: </p>
<ul>
<li><strong>a</strong> first integer to compare </li>
<li><strong>b</strong> second integer to compare </li>
</ul>
<p><strong>Return</strong>: int the smaller between a and b </p>
<h2 id="attributes-documentation">Attributes Documentation</h2>
<h3 id="variable-keybroadcast">variable keyBroadcast</h3>
<pre><code class="language-cpp">const uint8_t keyBroadcast = { 
  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
  0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
  0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
  0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x0f
};
</code></pre>
<h3 id="variable-frequency">variable frequency</h3>
<pre><code class="language-cpp">const long frequency = 868E6;
</code></pre>
<h3 id="variable-txpower">variable txPower</h3>
<pre><code class="language-cpp">const int txPower = 14;
</code></pre>
<h3 id="variable-spreadingfactor">variable spreadingFactor</h3>
<pre><code class="language-cpp">const int spreadingFactor = 7;
</code></pre>
<h3 id="variable-signalbandwidth">variable signalBandwidth</h3>
<pre><code class="language-cpp">const long signalBandwidth = 125E3;
</code></pre>
<h3 id="variable-codingratedenominator">variable codingRateDenominator</h3>
<pre><code class="language-cpp">const int codingRateDenominator = 5;
</code></pre>
<h3 id="variable-currmsg">variable currMsg</h3>
<pre><code class="language-cpp">int currMsg;
</code></pre>
<h3 id="variable-count">variable count</h3>
<pre><code class="language-cpp">int count;
</code></pre>
<h3 id="variable-prevmil">variable prevMil</h3>
<pre><code class="language-cpp">unsigned long prevMil;
</code></pre>
<h3 id="variable-prevmilsu">variable prevMilSU</h3>
<pre><code class="language-cpp">unsigned long prevMilSU;
</code></pre>
<h3 id="variable-msgcount">variable msgCount</h3>
<pre><code class="language-cpp">int msgCount;
</code></pre>
<h3 id="variable-msg_q">variable msg_q</h3>
<pre><code class="language-cpp">cppQueue msg_q;
</code></pre>
<h3 id="variable-ctxt">variable ctxt</h3>
<pre><code class="language-cpp">aes256_context ctxt;
</code></pre>
<h2 id="macros-documentation">Macros Documentation</h2>
<h3 id="define-implementation">define IMPLEMENTATION</h3>
<pre><code class="language-cpp">#define IMPLEMENTATION FIFO
</code></pre>
<h3 id="define-max_n_retry">define MAX_N_RETRY</h3>
<pre><code class="language-cpp">#define MAX_N_RETRY 3
</code></pre>
<h3 id="define-timeout_interval">define TIMEOUT_INTERVAL</h3>
<pre><code class="language-cpp">#define TIMEOUT_INTERVAL 1000
</code></pre>
<h3 id="define-max_queue_size">define MAX_QUEUE_SIZE</h3>
<pre><code class="language-cpp">#define MAX_QUEUE_SIZE 5
</code></pre>
<h3 id="define-block_size">define BLOCK_SIZE</h3>
<pre><code class="language-cpp">#define BLOCK_SIZE 16
</code></pre>
<h3 id="define-max_payload_size">define MAX_PAYLOAD_SIZE</h3>
<pre><code class="language-cpp">#define MAX_PAYLOAD_SIZE 16
</code></pre>
<h3 id="define-enc_block_size">define ENC_BLOCK_SIZE</h3>
<pre><code class="language-cpp">#define ENC_BLOCK_SIZE (1*BLOCK_SIZE)
</code></pre>
<h3 id="define-max_enc_payload_size">define MAX_ENC_PAYLOAD_SIZE</h3>
<pre><code class="language-cpp">#define MAX_ENC_PAYLOAD_SIZE ((MAX_PAYLOAD_SIZE/BLOCK_SIZE)*ENC_BLOCK_SIZE)+1
</code></pre>
<h3 id="define-max_msg_id">define MAX_MSG_ID</h3>
<pre><code class="language-cpp">#define MAX_MSG_ID 256
</code></pre>
<h3 id="define-status_update_interval">define STATUS_UPDATE_INTERVAL</h3>
<pre><code class="language-cpp">#define STATUS_UPDATE_INTERVAL 60000
</code></pre>
<h3 id="define-broadcast_id">define BROADCAST_ID</h3>
<pre><code class="language-cpp">#define BROADCAST_ID 0xFF
</code></pre>
<h2 id="source-code">Source code</h2>
<pre><code class="language-cpp">
#ifndef COMMS_PROTOCOL_H
#define COMMS_PROTOCOL_H

#include &lt;Arduino.h&gt;
#include &lt;SPI.h&gt;              
#include &lt;LoRa.h&gt;
#include &lt;cppQueue.h&gt;
#include &lt;aes256.h&gt;
#include &quot;node_definitions.h&quot;

#define  IMPLEMENTATION  FIFO

// LoRa msg payload settings
#define MAX_N_RETRY 3
#define TIMEOUT_INTERVAL 1000
#define MAX_QUEUE_SIZE 5

#define BLOCK_SIZE 16
#define MAX_PAYLOAD_SIZE 16
#define ENC_BLOCK_SIZE (1*BLOCK_SIZE)
#define MAX_ENC_PAYLOAD_SIZE ((MAX_PAYLOAD_SIZE/BLOCK_SIZE)*ENC_BLOCK_SIZE)+1

#define MAX_MSG_ID 256

#define STATUS_UPDATE_INTERVAL 60000

#define BROADCAST_ID 0xFF

// Broadcast Encryption key
const uint8_t keyBroadcast[] = { //
  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
  0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
  0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
  0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x0f
};



// LoRa Modem Settings
const long frequency = 868E6;
const int txPower = 14;
const int spreadingFactor = 7;
const long signalBandwidth = 125E3;
const int codingRateDenominator = 5;

typedef struct strPayload {
  byte nodeID;
  byte sensorID;
  byte msgID;
  char flag;
  byte sensorVal;
  int RSSI;
  float SNR;
} Payload;

typedef struct strMsg {
  byte msg[MAX_ENC_PAYLOAD_SIZE];
  byte msgID;
  char flag;
} Msg;

extern int currMsg;
extern int count;
extern unsigned long prevMil;
extern unsigned long prevMilSU;
extern int msgCount;

extern cppQueue msg_q;
extern aes256_context ctxt;

void LoRa_rxMode();
void LoRa_txMode();
void LoRa_sendMessage(byte *message);
char  *decryptMsg(String msg);
char  *decryptMsg2(char msg[MAX_PAYLOAD_SIZE+1]);

void onReceive(int packetSize);
void onTxDone();
String splitAndEncrypt(char msg[MAX_PAYLOAD_SIZE]);
void sendSensorData(byte sensorID, byte sensorVal);
void getMsgFromQueueAndSend(unsigned long currentMillis);
void sendStatus(byte msgID);
void sendAck(byte msgID);
void setActState(int ID, int val);
int mymin(int a, int b);

#endif
</code></pre>
<hr />
<p>Updated on 2022-08-24 at 20:13:31 +0000</p>




              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "search.share"], "search": "../../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>